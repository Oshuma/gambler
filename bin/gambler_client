#!/usr/bin/env ruby -w

GAMBLER_ROOT = File.join(File.dirname(__FILE__), '..')
$LOAD_PATH.unshift File.join(GAMBLER_ROOT, 'lib')

module Gambler

  # A simple Client which allows you to play around with Gambler.
  # Most of this class can be ignored, as it just sets up the gaming
  # environment.  The method to pay attention to is +play_blackjack+.
  # This is the method that actually creates and deals a Blackjack game.
  class Client
    WIDTH = 50

    attr_accessor :bots
    attr_accessor :player
    attr_accessor :player_quits

    def initialize
      @player = setup_player
      @bots = Array.new
    end

    # Add an AI Player as an opponent.
    def add_ai_player
      @bots << setup_player(:bot => true)
    end

    # Client header.
    def display_header
      puts
      puts ''.center(WIDTH, '=')
      puts " Gambler v#{Gambler::VERSION} ".center(WIDTH, '=')
      puts ''.center(WIDTH, '=')
      puts '----------------------------------------'.center(WIDTH)
      puts '| Feeding yet another human addiction. |'.center(WIDTH)
      puts '----------------------------------------'.center(WIDTH)
    end # of display_header

    # Pretty print the player's stats.
    def display_player_stats
      puts '- Players -'.center(WIDTH)
      seperator = "\t"
      stat_width = WIDTH - 5
      stats     = String.new
      bot_stats = String.new

      stats << "Player: #{@player.name}".ljust(WIDTH/2)
      stats << seperator
      stats << "Chips: #{@player.chips}"
      puts stats.center(stat_width)

      if @bots.empty?
        puts 'No AI opponents.'.center(WIDTH)
      else
        @bots.each do |bot|
          bot_stats  = "AI: #{bot.name}".ljust(WIDTH/2)
          bot_stats << seperator
          bot_stats << "Chips: #{bot.chips}"
          puts bot_stats.center(stat_width)
        end
      end
    end # of display_player_stats

    # Client game menu.
    def display_game_menu
      puts '-----------------------'.center(WIDTH)
      puts '|  1) Blackjack       |'.center(WIDTH)
      puts '|  2) Stud Poker      |'.center(WIDTH)
      puts "|  3) Texas Hold 'em  |".center(WIDTH)
      puts '|  A) Add AI Player   |'.center(WIDTH)
      puts '|  P) Setup Player    |'.center(WIDTH)
      puts '|  Q) Quit            |'.center(WIDTH)
      puts '-----------------------'.center(WIDTH)
      puts
      print 'Game: '
    end # of display_menu

    # Play a quick 1vs1 game of Blackjack.
    def play_blackjack
      if @bots.size <= 1
        puts 'Need at least two players for blackjack.'
        @bots << setup_player(:bot => true)
      end

      # Create an array and add the player and bots.
      players = Array.new
      players << @player
      players << @bots
      players.flatten!

      @game = Gambler::Game::Blackjack.new(:players => players)
    end # of play_blackjack

    # Setup a new Player instance.
    def setup_player(options = {})
      default_chips = 100
      if options[:bot]
        who = 'AI player'
        default_name = 'Kenny'
      else
        who = 'your player'
        default_name = 'Human'
      end

      puts "Setting up #{who}."
      print "Name [#{default_name}]: "
      name = STDIN.gets.chomp
      name = default_name if name.empty?

      print "Chips [#{default_chips}]: "
      chips = STDIN.gets.chomp.to_i
      chips = default_chips if chips.zero?

      return Player.new(name, :chips => chips)
    end # of setup_player

    # This is the main client menu.
    def menu
      display_header
      until player_quits do
        display_player_stats
        display_game_menu
        choice = STDIN.gets.chomp

        case choice
        when '1':
          play_blackjack
        when '2':
          puts 'This game is not implemented yet.'
        when '3':
          puts 'This game is not implemented yet.'
        when /a/i:
          add_ai_player
        when /p/i:
          setup_player
        when /q/i:
          player_quits = true
          exit
        else
          puts 'Invalid choice, dumbass.'
        end
      end
    end # of menu
  end # of Client

end # of Gambler

# Let's do this!
Gambler::Client.new.menu
